!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e||self).pegasysHelpers={})}(this,function(e){var t,n=/*#__PURE__*/function(){function e(){}return e.prototype.createQuestion=function(e,t){return{id:e,description:t}},e}();function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}const s="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function u(e,t,n){if(!e.s){if(n instanceof c){if(!n.s)return void(n.o=u.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(u.bind(null,e,t),u.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}var c=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(t,n){var r=new e,o=this.s;if(o){var i=1&o?t:n;if(i){try{u(r,1,i(this.v))}catch(e){u(r,2,e)}return r}return this}return this.o=function(e){try{var o=e.v;1&e.s?u(r,1,t?t(o):o):n?u(r,1,n(o)):u(r,2,o)}catch(e){u(r,2,e)}},r},e}();function a(e){return e instanceof c&&1&e.s}function f(e,t,n){var r,o,i=-1;return function s(f){try{for(;++i<e.length&&(!n||!n());)if((f=t(i))&&f.then){if(!a(f))return void f.then(s,o||(o=u.bind(null,r=new c,2)));f=f.v}r?u(r,1,f):r=f}catch(e){u(r||(r=new c),2,e)}}(),r}function l(e,t,n){if("function"==typeof e[s]){var r,o,i,l=function(e){try{for(;!((r=h.next()).done||n&&n());)if((e=t(r.value))&&e.then){if(!a(e))return void e.then(l,i||(i=u.bind(null,o=new c,2)));e=e.v}o?u(o,1,e):o=e}catch(e){u(o||(o=new c),2,e)}},h=e[s]();if(l(),h.return){var m=function(e){try{r.done||h.return()}catch(e){}return e};if(o&&o.then)return o.then(m,function(e){throw m(e)});m()}return o}if(!("length"in e))throw new TypeError("Object is not iterable");for(var v=[],d=0;d<e.length;d++)v.push(e[d]);return f(v,function(e){return t(v[e])},n)}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=3]="INFO",e[e.DEBUG=4]="DEBUG"}(t||(t={}));var h=t.ERROR;e.DTFunctions=/*#__PURE__*/function(){function e(){}var n=e.prototype;return n.performGradingPlatform=function(e){var t=e.oauth_client_id,n=e.oauth_client_secret,r=e.dt_account_urn,o=e.oauth_sso_endpoint,i=e.dt_platform_environment,s=e.documentType,u=e.documentName,c=e.validationId,a=e.maxScore,f=e.getScore;try{var l=this,h=null;return Promise.resolve(l.getOauthAccessToken(t,n,r,o)).then(function(e){if(!e)throw new Error("Failed to obtain access token");return Promise.resolve(l.getAuthorizationHeaderPlatform(e)).then(function(e){return h=e,Promise.resolve(l.getDocumentsList(i,s,u,h)).then(function(e){return Promise.resolve(l.getDocumentDetails(i,e,h)).then(function(t){return Promise.resolve(l.generateAuditInfo({documentList:e,documentDetails:t})).then(function(e){return Promise.resolve(f(e,h)).then(function(t){var n=t.score;return e.assertionFails=t.assertion_fails,{validationId:c,maxScore:a,finalScore:n,auditInfo:e}})})})})})})}catch(e){return Promise.reject(e)}},n.performGradingGen2=function(e){var t=e.dt_gen2_environment,n=e.dt_access_token,r=e.validationId,o=e.maxScore,i=e.entity_type,s=e.entity_name_to_query,u=e.config_endpoint,c=e.config_name_to_query,a=e.config_endpoint_extra_param,f=e.settings_schema_id,l=e.settings_scope,h=e.getScore;try{var m=this;return Promise.resolve(m.getAuthorizationHeaderGen2(n)).then(function(e){return Promise.resolve(m.getEntities(t,i,s,e)).then(function(n){return Promise.resolve(m.getEntitiesData(t,n,e)).then(function(i){return Promise.resolve(m.getConfigsList(t,u,c,a,n,e)).then(function(s){return Promise.resolve(m.getConfigsData(t,u,s,e)).then(function(u){return Promise.resolve(m.getSettingsData(t,n,e,f,l)).then(function(c){return Promise.resolve(m.getProblemsData(t,n,e)).then(function(t){return Promise.resolve(m.generateAuditInfo({entitiesList:n,entitiesData:i,settingsData:c,configList:s,configDetails:u,problemsData:t})).then(function(t){return Promise.resolve(h(t,e)).then(function(e){var n=e.score;return t.assertionFails=e.assertion_fails,{validationId:r,maxScore:o,finalScore:n,auditInfo:t}})})})})})})})})})}catch(e){return Promise.reject(e)}},n.getOauthAccessToken=function(e,n,r,o){try{var s=this,u=new Headers;u.append("Content-Type","application/x-www-form-urlencoded");var c=new URLSearchParams;c.append("grant_type","client_credentials"),c.append("client_id",e),c.append("client_secret",n),c.append("scope","document:documents:admin document:documents:read document:documents:write document:environment-shares:read document:direct-shares:read "),c.append("resource",r);var a={method:"POST",headers:u,body:c,redirect:"follow"};return Promise.resolve(i(function(){return Promise.resolve(fetch(o,a)).then(function(e){function n(n){return Promise.resolve(e.json()).then(function(e){return s.log(t.INFO,"result:\n"+JSON.stringify(e,null,2)),e.access_token})}var r=function(){if(!e.ok)return 400===e.status?Promise.resolve(e.text()).then(function(t){throw console.error("oAuth Access Token Error:",e.status,t),new Error("Bad Request: "+t)}):Promise.resolve(e.text()).then(function(t){throw console.error("oAuth Access Token Error:",e.status,t),new Error("HTTP error! status: "+e.status)})}();return r&&r.then?r.then(n):n()})},function(e){console.error("oAuth Access Token Error:",e.message)}))}catch(e){return Promise.reject(e)}},n.getAuthorizationHeaderPlatform=function(e){try{var t=new Headers;return t.append("Authorization","Bearer "+e),Promise.resolve(t)}catch(e){return Promise.reject(e)}},n.getAuthorizationHeaderGen2=function(e){try{var t=new Headers;return t.append("Authorization","Api-Token "+e),Promise.resolve(t)}catch(e){return Promise.reject(e)}},n.getEntities=function(e,t,n,r){try{var o=new Request(e+"/api/v2/entities?entitySelector=type("+t+"),entityName.contains("+n+")",{method:"GET",headers:r}),s=null,u=i(function(){return Promise.resolve(fetch(o)).then(function(e){var t=e.ok?Promise.resolve(e.json()).then(function(e){s=e}):Promise.resolve(e.text()).then(function(t){console.error("Entity ID Error:",e.status,t)});if(t&&t.then)return t.then(function(){})})},function(e){console.error(e)});return Promise.resolve(u&&u.then?u.then(function(){return s}):s)}catch(e){return Promise.reject(e)}},n.getEntitiesData=function(e,t,n){try{if(null===t)return Promise.resolve([]);var r=[],o=l(t.entities,function(t){var o=new Request(e+"/api/v2/entities/"+t.entityId,{method:"GET",headers:n}),s=i(function(){return Promise.resolve(fetch(o)).then(function(e){var t=e.ok?Promise.resolve(e.json()).then(function(e){r.push(e)}):Promise.resolve(e.text()).then(function(t){console.error("Entity Details Error:",e.status,t)});if(t&&t.then)return t.then(function(){})})},function(e){console.error(e)});if(s&&s.then)return s.then(function(){})});return Promise.resolve(o&&o.then?o.then(function(){return r}):r)}catch(e){return Promise.reject(e)}},n.getConfigsList=function(e,t,n,r,o,i){try{var s=this,u=[];if(""===t||!o)return Promise.resolve([]);var c="",a=function(){if(r.includes("/")){var a=l(o.entities,function(o){return c="/"+o.entityId+r,Promise.resolve(s.callConfigList(e,t,n,c,i)).then(function(e){u.push(e)})});if(a&&a.then)return a.then(function(){})}else{var f=r.includes("?")?(c=r,Promise.resolve(s.callConfigList(e,t,n,c,i)).then(function(e){u.push(e)})):Promise.resolve(s.callConfigList(e,t,n,c,i)).then(function(e){u.push(e)});if(f&&f.then)return f.then(function(){})}}();return Promise.resolve(a&&a.then?a.then(function(){return u}):u)}catch(e){return Promise.reject(e)}},n.callConfigList=function(e,t,n,r,o){try{var s=new Request(e+t+r,{method:"GET",headers:o}),u=[],c=i(function(){return Promise.resolve(fetch(s)).then(function(e){var t=e.ok?Promise.resolve(e.json()).then(function(e){u=e}):Promise.resolve(e.text()).then(function(t){console.error("ConfigList Error:",e.status,t)});if(t&&t.then)return t.then(function(){})})},function(e){console.error(e)});return Promise.resolve(c&&c.then?c.then(function(){return u}):u)}catch(e){return Promise.reject(e)}},n.getConfigsData=function(e,t,n,r){try{if(null===n)return Promise.resolve([]);var o=[],s=l(n,function(n){return function(s){var u=[];for(var c in s)u.push(c);return f(u,function(s){return function(s){return function(){if(s&&null!=s&&Array.isArray(n[s]))return l(n[s],function(n){var s=n?n.entityId||n.id:null,u=function(){if(s){var n=new Request(e+t+"/"+s,{method:"GET",headers:r}),u=i(function(){return Promise.resolve(fetch(n)).then(function(e){var t=e.ok?Promise.resolve(e.json()).then(function(e){o.push(e)}):Promise.resolve(e.text()).then(function(t){console.error("Config Data Error:",e.status,t)});if(t&&t.then)return t.then(function(){})})},function(e){console.error(e)});if(u&&u.then)return u.then(function(){})}}();if(u&&u.then)return u.then(function(){})})}()}(u[s])},void 0)}(n)});return Promise.resolve(s&&s.then?s.then(function(){return o}):o)}catch(e){return Promise.reject(e)}},n.getSettingsData=function(e,t,n,r,s){try{var u=[];if(""===r)return Promise.resolve([]);var c="";if("entity"===s)for(var a,f=o(t.entities);!(a=f()).done;)c=c+a.value.entityId+",";else c=s;if(""==c)return Promise.resolve([]);var l=new Request(e+"/api/v2/settings/objects?schemaIds="+r+"&scopes="+c,{method:"GET",headers:n}),h=i(function(){return Promise.resolve(fetch(l)).then(function(e){var t=e.ok?Promise.resolve(e.json()).then(function(e){u.push(e)}):Promise.resolve(e.text()).then(function(t){console.error("Settings Data Error:",e.status,t)});if(t&&t.then)return t.then(function(){})})},function(e){console.error(e)});return Promise.resolve(h&&h.then?h.then(function(){return u}):u)}catch(e){return Promise.reject(e)}},n.getProblemsData=function(e,t,n){try{if(!t||!t.entities||t.entities.length<=0)return Promise.resolve(null);for(var r,s="",u=o(t.entities);!(r=u()).done;)s+=","+r.value.entityId;s=s.substring(1);var c=new Request(e+"/api/v2/problems?from=now-6h&problemSelector=rootCauseEntity("+s+")",{method:"GET",headers:n}),a=null,f=i(function(){return Promise.resolve(fetch(c)).then(function(e){var t=e.ok?Promise.resolve(e.json()).then(function(e){a=e}):Promise.resolve(e.text()).then(function(t){console.error("Problems Data Error:",e.status,t)});if(t&&t.then)return t.then(function(){})})},function(e){console.error(e)});return Promise.resolve(f&&f.then?f.then(function(){return a}):a)}catch(e){return Promise.reject(e)}},n.getDocumentsList=function(e,n,r,o){try{var s=this,u="name contains '"+r+"' and type == '"+n+"'",c=new Request(e+"/platform/document/v1/documents?admin-access=true&filter="+encodeURIComponent(u),{method:"GET",headers:o});s.log(t.INFO,"documentFilter:\n"+JSON.stringify(u,null,2));var a=null,f=i(function(){return s.log(t.INFO,"headers:\n"+JSON.stringify(o,null,2)),Promise.resolve(fetch(c)).then(function(e){s.log(t.INFO,"response:\n"+JSON.stringify(e,null,2));var n=e.ok?Promise.resolve(e.json()).then(function(e){a=e}):Promise.resolve(e.text()).then(function(t){console.error("Document List Error:",e.status,t)});if(n&&n.then)return n.then(function(){})})},function(e){console.error(e)});return Promise.resolve(f&&f.then?f.then(function(){return a}):a)}catch(e){return Promise.reject(e)}},n.getDocumentDetails=function(e,t,n){try{if(null===t)return Promise.resolve([]);var r=[],o={method:"GET",headers:n},s=l(t.documents,function(t){var n=String(t.id),s=i(function(){return Promise.resolve(fetch(e+"/platform/document/v1/documents/"+n+"/content?admin-access=true",o)).then(function(e){var t=e.ok?Promise.resolve(e.json()).then(function(e){r.push(e)}):Promise.resolve(e.text()).then(function(t){console.error("Document Details Error:",e.status,t)});if(t&&t.then)return t.then(function(){})})},function(e){console.error(e)});if(s&&s.then)return s.then(function(){})});return Promise.resolve(s&&s.then?s.then(function(){return r}):r)}catch(e){return Promise.reject(e)}},n.generateAuditInfo=function(e){var t=e.documentList,n=e.documentDetails,r=e.entitiesList,o=e.entitiesData,i=e.settingsData,s=e.configList,u=e.configDetails,c=e.problemsData;try{var a={};return null!=t&&(a.documentList=t),null!=n&&(a.documentDetails=n),null!=r&&(a.entitiesList=r),null!=o&&(a.entitiesData=o),null!=s&&(a.configList=s),null!=u&&null==u.error&&(a.configDetails=u),null!=i&&(a.settingsData=i),null!=c&&(a.problemsData=c),a.assertionFails=[],Promise.resolve(a)}catch(e){return Promise.reject(e)}},n.checkKeywordsExistence=function(e,t){return t.every(function(t){return e.toLowerCase().includes(t.toLowerCase())})},n.findIdInObject=function(e){for(var t in e)if(e.hasOwnProperty(t))if("object"==typeof e[t]){var n=this.findIdInObject(e[t]);if(n)return n}else if("id"===t||"entityId"===t)return e[t];return null},n.log=function(e,t){e<=h&&console.log(t)},e}(),e.QuestionSDK=n});
//# sourceMappingURL=index.umd.js.map
